@startuml
left to right direction
skinparam shadowing false
skinparam packageStyle rectangle

actor "Guest" as Guest
actor "User" as User
actor "Admin" as Admin
actor "Trigger Worker" as TriggerWorker
actor "OCR Engine" as OCR
actor "LLM Service" as LLM
actor "Vector Store" as VectorStore

Admin -|> User

rectangle "DocFlow System" {
  usecase "Register account" as UC_Register
  usecase "Log in" as UC_Login
  usecase "Log out" as UC_Logout

  usecase "Upload document" as UC_Upload
  usecase "Process document" as UC_Process
  usecase "Auto-process document" as UC_AutoProcess
  usecase "Classify document type" as UC_Classify
  usecase "Run OCR extraction" as UC_RunOCR
  usecase "Save processing run" as UC_SaveRun
  usecase "Index document for search" as UC_Index

  usecase "View processing history" as UC_History
  usecase "Open processed document" as UC_OpenDoc
  usecase "Edit extracted field" as UC_EditField
  usecase "Mark document reviewed" as UC_MarkDocReviewed
  usecase "Mark run reviewed" as UC_MarkRunReviewed
  usecase "Change run document type" as UC_ChangeDocType
  usecase "Export run data (XLSX/CSV)" as UC_Export

  usecase "Query document (Q&A)" as UC_Query
  usecase "View query history" as UC_QueryHistory
  usecase "Clear query history" as UC_ClearQueryHistory
  usecase "Semantic search" as UC_Search

  usecase "Manage triggers" as UC_Triggers
  usecase "Track async task status" as UC_TaskStatus

  usecase "Manage document types" as UC_DocTypes
  usecase "Reindex search index" as UC_Reindex
}

Guest --> UC_Register
Guest --> UC_Login

User --> UC_Login
User --> UC_Logout
User --> UC_Upload
User --> UC_Process
User --> UC_AutoProcess
User --> UC_History
User --> UC_OpenDoc
User --> UC_EditField
User --> UC_MarkDocReviewed
User --> UC_MarkRunReviewed
User --> UC_ChangeDocType
User --> UC_Export
User --> UC_Query
User --> UC_QueryHistory
User --> UC_ClearQueryHistory
User --> UC_Search
User --> UC_Triggers
User --> UC_TaskStatus

Admin --> UC_DocTypes
Admin --> UC_Reindex

TriggerWorker --> UC_AutoProcess

UC_Process .> UC_Upload : <<include>>
UC_Process .> UC_RunOCR : <<include>>
UC_Process .> UC_SaveRun : <<include>>
UC_Process .> UC_Index : <<include>>

UC_AutoProcess .> UC_RunOCR : <<include>>
UC_AutoProcess .> UC_Classify : <<include>>
UC_AutoProcess .> UC_SaveRun : <<include>>
UC_AutoProcess .> UC_Index : <<include>>

OCR --> UC_RunOCR
LLM --> UC_Classify
LLM --> UC_Query
LLM --> UC_Search

VectorStore --> UC_Index
VectorStore --> UC_Search
VectorStore --> UC_Reindex
@enduml
